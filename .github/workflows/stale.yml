name: Close Stale Issues and PRs

on:
  schedule:
    - cron: '0 2 * * *'  # Run daily at 2 AM UTC
  workflow_dispatch:

permissions:
  issues: write
  pull-requests: write

jobs:
  stale:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/stale@v9.0.0
        with:
          # General settings
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          days-before-stale: 60
          days-before-close: 14
          
          # Issues
          stale-issue-message: |
            This issue has been automatically marked as stale because it has not had recent activity. 
            It will be closed in 14 days if no further activity occurs. 
            
            If this issue is still relevant, please:
            - Add a comment to keep it open
            - Add the "keep-open" label to prevent auto-closure
            - Provide any additional context or updates
            
            Thank you for your contributions to the Shugur Relay project! üöÄ
          
          close-issue-message: |
            This issue has been automatically closed due to inactivity.
            
            If this issue is still relevant, please feel free to reopen it or create a new issue with updated information.
          
          stale-issue-label: 'stale'
          close-issue-label: 'auto-closed'
          
          # Pull Requests  
          stale-pr-message: |
            This pull request has been automatically marked as stale because it has not had recent activity.
            It will be closed in 14 days if no further activity occurs.
            
            If this PR is still relevant, please:
            - Rebase or merge the latest changes from the target branch
            - Add a comment explaining the current status
            - Add the "keep-open" label to prevent auto-closure
            - Request a review if ready for merge
            
            Thank you for your contribution! üôè
          
          close-pr-message: |
            This pull request has been automatically closed due to inactivity.
            
            If you'd like to continue working on this, please feel free to reopen it and update as needed.
          
          stale-pr-label: 'stale'
          close-pr-label: 'auto-closed'
          
          # Exempt labels (issues/PRs with these labels won't be marked stale)
          exempt-issue-labels: 'keep-open,security,critical,help-wanted,good-first-issue,epic'
          exempt-pr-labels: 'keep-open,security,critical,work-in-progress,draft'
          
          # Exempt assignees and milestones
          exempt-all-assignees: true
          exempt-all-milestones: true
          
          # Only process a limited number to avoid hitting API rate limits
          operations-per-run: 100
          
          # Remove stale label when there's new activity
          remove-stale-when-updated: true
          
          # Debug mode (set to true for testing)
          debug-only: false